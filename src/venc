#! /usr/bin/python3

#    Copyright 2016, 2017 Denis Salem
#
#    This file is part of VenC.
#
#    VenC is free software: you can redistribute it and/or modify
#    it under the terms of the GNU General Public License as published by
#    the Free Software Foundation, either version 3 of the License, or
#    (at your option) any later version.
#
#    VenC is distributed in the hope that it will be useful,
#    but WITHOUT ANY WARRANTY; without even the implied warranty of
#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#    GNU General Public License for more details.
#
#    You should have received a copy of the GNU General Public License
#    along with VenC.  If not, see <http://www.gnu.org/licenses/>.

import sys

from VenC.commands.export import export_blog
from VenC.commands.export import edit_and_export
from VenC.commands.export import export_and_remote_copy
from VenC.commands.install import install_theme
from VenC.commands.new import new_blog
from VenC.commands.new import new_entry
from VenC.commands.print import print_version
from VenC.commands.print import print_themes
from VenC.commands.print import print_help
from VenC.commands.remote import remote_copy
from VenC.helpers import notify
from VenC.l10n import Messages; 

command_index = {"-v":                  [print_version, 0],
                "-nb":                  [new_blog, -1],
                "-ne":                  [new_entry, 2],
                "-xb":                  [export_blog, 1],
                "-ex":                  [edit_and_export, 1],
                "-xftp":                [export_and_remote_copy, 1],
                "-rc":                  [remote_copy, 0],
                "-it":                  [install_theme, 1],
                "-h":                   [print_help, 0],
                "-t":                   [print_themes, 0],
                "--themes":             [print_themes, 0],
                "--help":               [print_help, 0],
                "--remote-copy":        [remote_copy, 0],
                "--export-via-ftp":     [export_and_remote_copy, 1],
                "--edit-and-export":    [edit_and_export, 1],
                "--install-theme":      [install_theme, 1],
                "--export-blog":        [export_llog, 1],
                "--new-entry":          [new_entry, 2],
                "--new-blog":           [new_blog, -1],
                "--version":            [print_version, 0]}

def argv_handler(argv=None):
    argv = argv if argv != None else sys.argv[1:]
    if argv != []: 
       if argv[0] in command_index:
           if command_index[argv[0]][1] != -1: 
               arguments = argv[1:command_index[argv[0]][1]+1]
           
           else:
               arguments = list()
               for argument in argv[1:]:
                   if argument not in command_index.keys():
                       arguments.append(argument)

                   else:
                       break

           command_index[argv[0]][0](arguments)
           argv_handler(argv[len(arguments)+1:])

       else:
           notify(Messages.unknownCommand.format(argv[0]),"RED")
           argv_handler(argv[1:])

if sys.argv[1:] != []: 
    argv_handler()

else:
    notify(Messages.nothing_to_do,"YELLOW")

